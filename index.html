<!DOCTYPE html>
<meta charset="utf-8">
<style>
	.lds {
        fill: steelblue;
    }

</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="https://npmcdn.com/simple-statistics@2.0.0/dist/simple-statistics.min.js"></script>

<script>

var width = 960;
var height = 580;

// Create SVG
var svg = d3.select( "body" )
    .append( "svg" )
    .attr( "width", width )
    .attr( "height", height );
    
var g = svg.append( "g" );

var albersProjection = d3.geo.albers()
   .rotate([96, 0])
    .center([-.6, 38.7])
    .parallels([29.5, 45.5])
    .scale(1070)
    .translate([width / 2, height / 2])
    .precision(.1);

// Create GeoPath function that uses built-in D3 functionality to turn
// lat/lon coordinates into screen coordinates
var geoPath = d3.geo.path()
    .projection( albersProjection );

// Classic D3... Select non-existent elements, bind the data, append the elements, and apply attributes
    
    queue()
        .defer(d3.json, "religion.json")
        .await(ready);
      
       function ready(error, collection){
	       
	       
        var attribute = "lds"; // alternative is "oil_wells"
        
        var breaks = ss.jenks(collection.objects.collection.geometries.map(function(d) { 
            return d.properties[attribute]/d.properties.aland; 
        }), 5);
        
        breaks.shift(); // remove min value from breaks Array before applying to domain
        breaks.pop(); // same for max
        
        var colors = ["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"];
        var jenks = d3.scale.threshold()
            .domain(breaks)
            .range(colors);
        
         svg.append("g")
      svg.append("g")
            .selectAll("path")
            .data( topojson.feature(collection, collection.objects.collection).features)
            .enter()
            .append("path")
            .attr( "d", geoPath )
            .attr("class","county")
            .attr( "fill", function(d){
                return jenks(d.properties[attribute]/d.properties.ALAND);  
            }); 
    }


</script>
